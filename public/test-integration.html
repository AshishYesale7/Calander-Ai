<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar.ai Chrome AI Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .test-section.success { border-color: #4CAF50; background: #f1f8e9; }
        .test-section.error { border-color: #f44336; background: #ffebee; }
        .test-section.warning { border-color: #ff9800; background: #fff3e0; }
        .test-section.running { border-color: #2196F3; background: #e3f2fd; }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        
        .test-card.passed { border-left: 4px solid #4CAF50; }
        .test-card.failed { border-left: 4px solid #f44336; }
        .test-card.running { border-left: 4px solid #2196F3; }
        
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            transition: background 0.3s;
        }
        button:hover { background: #1976D2; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        
        .code {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            font-size: 12px;
            overflow-x: auto;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-indicator.success { background: #4CAF50; }
        .status-indicator.error { background: #f44336; }
        .status-indicator.warning { background: #ff9800; }
        .status-indicator.running { background: #2196F3; animation: pulse 1s infinite; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #2196F3;
            transition: width 0.3s;
        }
        
        .results-summary {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ü§ñ</div>
            <h1>Calendar.ai Chrome AI Integration Test</h1>
            <p>Comprehensive testing suite for Google Chrome AI Hackathon 2025</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div id="progress-text">Ready to start testing...</div>
        </div>

        <div class="test-section" id="controls">
            <h2>Test Controls</h2>
            <button onclick="runAllTests()" id="run-all-btn">üöÄ Run All Tests</button>
            <button onclick="runQuickTest()" id="quick-test-btn">‚ö° Quick Test</button>
            <button onclick="runPerformanceTest()" id="perf-test-btn">üìä Performance Test</button>
            <button onclick="clearResults()" id="clear-btn">üóëÔ∏è Clear Results</button>
            <button onclick="exportResults()" id="export-btn">üìÑ Export Results</button>
        </div>

        <div class="test-section" id="environment-check">
            <h2><span class="status-indicator" id="env-status"></span>Environment Check</h2>
            <div id="env-results">Click "Run All Tests" to check environment...</div>
        </div>

        <div class="test-section" id="api-tests">
            <h2><span class="status-indicator" id="api-status"></span>Chrome AI API Tests</h2>
            <div class="test-grid" id="api-grid">
                <!-- API test cards will be populated here -->
            </div>
        </div>

        <div class="test-section" id="integration-tests">
            <h2><span class="status-indicator" id="integration-status"></span>Integration Tests</h2>
            <div class="test-grid" id="integration-grid">
                <!-- Integration test cards will be populated here -->
            </div>
        </div>

        <div class="test-section" id="performance-tests">
            <h2><span class="status-indicator" id="performance-status"></span>Performance Tests</h2>
            <div id="performance-results">Performance tests not run yet...</div>
        </div>

        <div class="results-summary" id="results-summary" style="display: none;">
            <h2>üìä Test Results Summary</h2>
            <div id="summary-content"></div>
        </div>
    </div>

    <script>
        // Load the test suite
        const script = document.createElement('script');
        script.src = '/test-chrome-ai-integration.js';
        document.head.appendChild(script);

        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            details: []
        };

        function updateProgress(current, total, message) {
            const percentage = Math.round((current / total) * 100);
            document.getElementById('progress-fill').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = message || `${current}/${total} tests completed (${percentage}%)`;
        }

        function updateStatus(elementId, status) {
            const indicator = document.getElementById(elementId);
            indicator.className = `status-indicator ${status}`;
        }

        function createTestCard(name, status, result, error) {
            return `
                <div class="test-card ${status}">
                    <h4>${name}</h4>
                    <div class="status-indicator ${status}"></div>
                    <span>${status.toUpperCase()}</span>
                    ${result ? `<div class="code">${JSON.stringify(result, null, 2).substring(0, 200)}...</div>` : ''}
                    ${error ? `<div class="code" style="color: #d32f2f;">${error}</div>` : ''}
                </div>
            `;
        }

        async function runAllTests() {
            const runBtn = document.getElementById('run-all-btn');
            runBtn.disabled = true;
            runBtn.textContent = 'üîÑ Running Tests...';

            try {
                // Wait for test suite to load
                if (typeof ChromeAIIntegrationTester === 'undefined') {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                if (typeof ChromeAIIntegrationTester === 'undefined') {
                    throw new Error('Test suite not loaded. Please refresh the page.');
                }

                const tester = new ChromeAIIntegrationTester();
                
                // Override the test method to update UI
                const originalTest = tester.test.bind(tester);
                let testCount = 0;
                const totalTests = 16; // Approximate number of tests

                tester.test = async function(name, testFn) {
                    testCount++;
                    updateProgress(testCount, totalTests, `Running: ${name}`);
                    
                    // Update specific section status
                    if (name.includes('Environment') || name.includes('Browser') || name.includes('Availability')) {
                        updateStatus('env-status', 'running');
                    } else if (name.includes('API') || name.includes('Language') || name.includes('Summarizer')) {
                        updateStatus('api-status', 'running');
                    } else if (name.includes('Integration') || name.includes('Service') || name.includes('Voice')) {
                        updateStatus('integration-status', 'running');
                    } else if (name.includes('Performance') || name.includes('Memory')) {
                        updateStatus('performance-status', 'running');
                    }

                    const result = await originalTest(name, testFn);
                    
                    // Update UI with result
                    const status = result ? 'passed' : 'failed';
                    const error = result ? null : tester.results.errors[tester.results.errors.length - 1]?.error;
                    
                    // Add to appropriate grid
                    if (name.includes('Language') || name.includes('Summarizer') || name.includes('Writer') || 
                        name.includes('Rewriter') || name.includes('Translator') || name.includes('Proofreader')) {
                        document.getElementById('api-grid').innerHTML += createTestCard(name, status, result, error);
                    } else if (name.includes('Service') || name.includes('Voice') || name.includes('Context') || name.includes('Flows')) {
                        document.getElementById('integration-grid').innerHTML += createTestCard(name, status, result, error);
                    }

                    return result;
                };

                // Run all tests
                await tester.runAllTests();
                
                // Update final status
                const successRate = Math.round((tester.results.passed / (tester.results.passed + tester.results.failed)) * 100);
                
                updateStatus('env-status', successRate >= 80 ? 'success' : 'error');
                updateStatus('api-status', successRate >= 80 ? 'success' : 'error');
                updateStatus('integration-status', successRate >= 80 ? 'success' : 'error');
                updateStatus('performance-status', successRate >= 80 ? 'success' : 'error');

                // Show results summary
                showResultsSummary(tester.results);
                
                updateProgress(totalTests, totalTests, `‚úÖ All tests completed! Success rate: ${successRate}%`);

            } catch (error) {
                console.error('Test execution failed:', error);
                document.getElementById('progress-text').textContent = `‚ùå Test execution failed: ${error.message}`;
                updateStatus('env-status', 'error');
            } finally {
                runBtn.disabled = false;
                runBtn.textContent = 'üöÄ Run All Tests';
            }
        }

        async function runQuickTest() {
            const quickBtn = document.getElementById('quick-test-btn');
            quickBtn.disabled = true;
            quickBtn.textContent = '‚ö° Running Quick Test...';

            try {
                // Quick environment check
                updateStatus('env-status', 'running');
                
                const envCheck = {
                    chromeAI: !!window.ai,
                    browser: navigator.userAgent.includes('Chrome'),
                    canary: navigator.userAgent.includes('Canary') || navigator.userAgent.includes('Dev')
                };

                document.getElementById('env-results').innerHTML = `
                    <div class="code">
                        Chrome AI Available: ${envCheck.chromeAI ? '‚úÖ' : '‚ùå'}<br>
                        Chrome Browser: ${envCheck.browser ? '‚úÖ' : '‚ùå'}<br>
                        Chrome Canary/Dev: ${envCheck.canary ? '‚úÖ' : '‚ùå'}
                    </div>
                `;

                if (envCheck.chromeAI) {
                    // Quick API test
                    updateStatus('api-status', 'running');
                    const session = await window.ai.languageModel.create();
                    const response = await session.prompt('Hello!');
                    session.destroy();
                    
                    document.getElementById('api-grid').innerHTML = createTestCard(
                        'Quick Language Model Test', 
                        'passed', 
                        { response: response.substring(0, 100) + '...' }
                    );
                    
                    updateStatus('env-status', 'success');
                    updateStatus('api-status', 'success');
                    updateProgress(1, 1, '‚úÖ Quick test completed successfully!');
                } else {
                    updateStatus('env-status', 'error');
                    updateProgress(1, 1, '‚ùå Chrome AI not available');
                }

            } catch (error) {
                console.error('Quick test failed:', error);
                updateStatus('env-status', 'error');
                updateStatus('api-status', 'error');
                updateProgress(1, 1, `‚ùå Quick test failed: ${error.message}`);
            } finally {
                quickBtn.disabled = false;
                quickBtn.textContent = '‚ö° Quick Test';
            }
        }

        async function runPerformanceTest() {
            const perfBtn = document.getElementById('perf-test-btn');
            perfBtn.disabled = true;
            perfBtn.textContent = 'üìä Running Performance Test...';

            try {
                updateStatus('performance-status', 'running');
                
                const startTime = performance.now();
                const session = await window.ai.languageModel.create();
                
                const tests = [];
                for (let i = 0; i < 5; i++) {
                    const testStart = performance.now();
                    const response = await session.prompt(`Test prompt ${i + 1}`);
                    const testEnd = performance.now();
                    tests.push({
                        test: i + 1,
                        time: Math.round(testEnd - testStart),
                        responseLength: response.length
                    });
                }
                
                session.destroy();
                const totalTime = performance.now() - startTime;
                
                const avgTime = Math.round(tests.reduce((sum, test) => sum + test.time, 0) / tests.length);
                
                document.getElementById('performance-results').innerHTML = `
                    <div class="code">
                        Total Time: ${Math.round(totalTime)}ms<br>
                        Average Response Time: ${avgTime}ms<br>
                        Tests Completed: ${tests.length}<br>
                        Performance Rating: ${avgTime < 2000 ? 'Excellent' : avgTime < 4000 ? 'Good' : 'Needs Improvement'}
                    </div>
                    <h4>Individual Test Results:</h4>
                    ${tests.map(test => `<div>Test ${test.test}: ${test.time}ms (${test.responseLength} chars)</div>`).join('')}
                `;
                
                updateStatus('performance-status', avgTime < 4000 ? 'success' : 'warning');
                updateProgress(1, 1, 'üìä Performance test completed!');

            } catch (error) {
                console.error('Performance test failed:', error);
                document.getElementById('performance-results').innerHTML = `<div class="code" style="color: #d32f2f;">Performance test failed: ${error.message}</div>`;
                updateStatus('performance-status', 'error');
                updateProgress(1, 1, '‚ùå Performance test failed');
            } finally {
                perfBtn.disabled = false;
                perfBtn.textContent = 'üìä Performance Test';
            }
        }

        function clearResults() {
            document.getElementById('env-results').textContent = 'Click "Run All Tests" to check environment...';
            document.getElementById('api-grid').innerHTML = '';
            document.getElementById('integration-grid').innerHTML = '';
            document.getElementById('performance-results').textContent = 'Performance tests not run yet...';
            document.getElementById('results-summary').style.display = 'none';
            
            // Reset status indicators
            ['env-status', 'api-status', 'integration-status', 'performance-status'].forEach(id => {
                document.getElementById(id).className = 'status-indicator';
            });
            
            updateProgress(0, 1, 'Ready to start testing...');
        }

        function showResultsSummary(results) {
            const summary = document.getElementById('results-summary');
            const content = document.getElementById('summary-content');
            
            const successRate = Math.round((results.passed / (results.passed + results.failed)) * 100);
            
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 15px; background: #e8f5e8; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #2e7d32;">${results.passed}</div>
                        <div>Tests Passed</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #ffebee; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #c62828;">${results.failed}</div>
                        <div>Tests Failed</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: bold; color: #1565c0;">${successRate}%</div>
                        <div>Success Rate</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3>Overall Assessment:</h3>
                    <div style="padding: 15px; border-radius: 8px; ${successRate >= 80 ? 'background: #e8f5e8; color: #2e7d32;' : 'background: #ffebee; color: #c62828;'}">
                        ${successRate >= 90 ? 'üéâ Excellent! Chrome AI integration is working perfectly!' :
                          successRate >= 70 ? 'üëç Good! Chrome AI integration is mostly working with minor issues.' :
                          successRate >= 50 ? '‚ö†Ô∏è Partial! Chrome AI integration has some issues that need attention.' :
                          'üö® Critical! Chrome AI integration has major issues that need immediate attention.'}
                    </div>
                </div>
                
                ${results.errors.length > 0 ? `
                    <div style="margin-top: 20px;">
                        <h3>Failed Tests:</h3>
                        ${results.errors.map(error => `<div style="margin: 5px 0; padding: 10px; background: #ffebee; border-radius: 4px;">‚ùå ${error.name}: ${error.error}</div>`).join('')}
                    </div>
                ` : ''}
            `;
            
            summary.style.display = 'block';
        }

        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                testResults: testResults,
                chromeAIAvailable: !!window.ai,
                apis: window.ai ? {
                    languageModel: !!window.ai.languageModel,
                    summarizer: !!window.ai.summarizer,
                    writer: !!window.ai.writer,
                    rewriter: !!window.ai.rewriter,
                    translator: !!window.ai.translator,
                    proofreader: !!window.ai.proofreader
                } : null
            };

            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `chrome-ai-test-results-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ü§ñ Calendar.ai Chrome AI Integration Test Page Loaded');
            console.log('üìã Use the buttons above to run tests');
            
            // Check if we're in the right environment
            if (!navigator.userAgent.includes('Chrome')) {
                document.getElementById('env-results').innerHTML = '<div style="color: #d32f2f;">‚ùå Chrome browser required for testing</div>';
                updateStatus('env-status', 'error');
            } else if (!navigator.userAgent.includes('Canary') && !navigator.userAgent.includes('Dev')) {
                document.getElementById('env-results').innerHTML = '<div style="color: #ff9800;">‚ö†Ô∏è Chrome Canary or Dev recommended for Chrome AI testing</div>';
                updateStatus('env-status', 'warning');
            }
        });
    </script>
</body>
</html>